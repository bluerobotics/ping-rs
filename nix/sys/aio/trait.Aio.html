<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Methods common to all AIO operations"><title>Aio in nix::sys::aio - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-c5d6553a23f1e5a6.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="nix" data-themes="" data-resource-suffix="" data-rustdoc-version="1.81.0 (eeb90cda1 2024-09-04)" data-channel="1.81.0" data-search-js="search-d234aafac6c221dd.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../static.files/main-d2fab2bf619172d3.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../nix/index.html">nix</a><span class="version">0.26.4</span></h2></div><h2 class="location"><a href="#">Aio</a></h2><div class="sidebar-elems"><section><h3><a href="#required-associated-types">Required Associated Types</a></h3><ul class="block"><li><a href="#associatedtype.Output">Output</a></li></ul><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.aio_return">aio_return</a></li><li><a href="#tymethod.cancel">cancel</a></li><li><a href="#tymethod.error">error</a></li><li><a href="#tymethod.fd">fd</a></li><li><a href="#tymethod.in_progress">in_progress</a></li><li><a href="#tymethod.priority">priority</a></li><li><a href="#tymethod.set_sigev_notify">set_sigev_notify</a></li><li><a href="#tymethod.sigevent">sigevent</a></li><li><a href="#tymethod.submit">submit</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In nix::sys::aio</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../../index.html">nix</a>::<wbr><a href="../index.html">sys</a>::<wbr><a href="index.html">aio</a>::<wbr><a class="trait" href="#">Aio</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../src/nix/sys/aio.rs.html#213-358">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait Aio {
    type <a href="#associatedtype.Output" class="associatedtype">Output</a>;

    // Required methods
    fn <a href="#tymethod.aio_return" class="fn">aio_return</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.81.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.reference.html">&amp;mut Self</a>&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;Self::<a class="associatedtype" href="trait.Aio.html#associatedtype.Output" title="type nix::sys::aio::Aio::Output">Output</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.cancel" class="fn">cancel</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.81.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.reference.html">&amp;mut Self</a>&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="enum" href="enum.AioCancelStat.html" title="enum nix::sys::aio::AioCancelStat">AioCancelStat</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.error" class="fn">error</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.81.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.reference.html">&amp;mut Self</a>&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.unit.html">()</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.fd" class="fn">fd</a>(&amp;self) -&gt; <a class="type" href="https://doc.rust-lang.org/1.81.0/std/os/fd/raw/type.RawFd.html" title="type std::os::fd::raw::RawFd">RawFd</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.in_progress" class="fn">in_progress</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.bool.html">bool</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.priority" class="fn">priority</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.i32.html">i32</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.set_sigev_notify" class="fn">set_sigev_notify</a>(&amp;mut self, sev: <a class="enum" href="../signal/enum.SigevNotify.html" title="enum nix::sys::signal::SigevNotify">SigevNotify</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.sigevent" class="fn">sigevent</a>(&amp;self) -&gt; <a class="struct" href="../signal/struct.SigEvent.html" title="struct nix::sys::signal::SigEvent">SigEvent</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.submit" class="fn">submit</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.81.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.reference.html">&amp;mut Self</a>&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.unit.html">()</a>&gt;;
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Methods common to all AIO operations</p>
</div></details><h2 id="required-associated-types" class="section-header">Required Associated Types<a href="#required-associated-types" class="anchor">§</a></h2><div class="methods"><details class="toggle" open><summary><section id="associatedtype.Output" class="method"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#215">source</a><h4 class="code-header">type <a href="#associatedtype.Output" class="associatedtype">Output</a></h4></section></summary><div class="docblock"><p>The return type of <a href="trait.Aio.html#tymethod.aio_return" title="method nix::sys::aio::Aio::aio_return"><code>Aio::aio_return</code></a>.</p>
</div></details></div><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.aio_return" class="method"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#226">source</a><h4 class="code-header">fn <a href="#tymethod.aio_return" class="fn">aio_return</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.81.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.reference.html">&amp;mut Self</a>&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;Self::<a class="associatedtype" href="trait.Aio.html#associatedtype.Output" title="type nix::sys::aio::Aio::Output">Output</a>&gt;</h4></section></summary><div class="docblock"><p>Retrieve return status of an asynchronous operation.</p>
<p>Should only be called once for each operation, after <a href="trait.Aio.html#tymethod.error" title="method nix::sys::aio::Aio::error"><code>Aio::error</code></a>
indicates that it has completed.  The result is the same as for the
synchronous <code>read(2)</code>, <code>write(2)</code>, of <code>fsync(2)</code> functions.</p>
<h5 id="references"><a class="doc-anchor" href="#references">§</a>References</h5>
<p><a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/aio_return.html">aio_return</a></p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.cancel" class="method"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#272">source</a><h4 class="code-header">fn <a href="#tymethod.cancel" class="fn">cancel</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.81.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.reference.html">&amp;mut Self</a>&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="enum" href="enum.AioCancelStat.html" title="enum nix::sys::aio::AioCancelStat">AioCancelStat</a>&gt;</h4></section></summary><div class="docblock"><p>Cancels an outstanding AIO request.</p>
<p>The operating system is not required to implement cancellation for all
file and device types.  Even if it does, there is no guarantee that the
operation has not already completed.  So the caller must check the
result and handle operations that were not canceled or that have already
completed.</p>
<h5 id="examples"><a class="doc-anchor" href="#examples">§</a>Examples</h5>
<p>Cancel an outstanding aio operation.  Note that we must still call
<code>aio_return</code> to free resources, even though we don’t care about the
result.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>wbuf = <span class="string">b"CDEF"</span>;
<span class="kw">let </span><span class="kw-2">mut </span>f = tempfile().unwrap();
<span class="kw">let </span><span class="kw-2">mut </span>aiocb = Box::pin(AioWrite::new(f.as_raw_fd(),
    <span class="number">2</span>,   <span class="comment">//offset
    </span><span class="kw-2">&amp;</span>wbuf[..],
    <span class="number">0</span>,   <span class="comment">//priority
    </span>SigevNotify::SigevNone));
aiocb.as_mut().submit().unwrap();
<span class="kw">let </span>cs = aiocb.as_mut().cancel().unwrap();
<span class="kw">if </span>cs == AioCancelStat::AioNotCanceled {
    <span class="kw">while </span>(aiocb.as_mut().error() == <span class="prelude-val">Err</span>(Errno::EINPROGRESS)) {
        thread::sleep(time::Duration::from_millis(<span class="number">10</span>));
    }
}
<span class="comment">// Must call `aio_return`, but ignore the result
</span><span class="kw">let _ </span>= aiocb.as_mut().aio_return();</code></pre></div>
<h5 id="references-1"><a class="doc-anchor" href="#references-1">§</a>References</h5>
<p><a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/aio_cancel.html">aio_cancel</a></p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.error" class="method"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#309">source</a><h4 class="code-header">fn <a href="#tymethod.error" class="fn">error</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.81.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.reference.html">&amp;mut Self</a>&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Retrieve error status of an asynchronous operation.</p>
<p>If the request has not yet completed, returns <code>EINPROGRESS</code>.  Otherwise,
returns <code>Ok</code> or any other error.</p>
<h5 id="examples-1"><a class="doc-anchor" href="#examples-1">§</a>Examples</h5>
<p>Issue an aio operation and use <code>error</code> to poll for completion.  Polling
is an alternative to <code>aio_suspend</code>, used by most of the other examples.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">const </span>WBUF: <span class="kw-2">&amp;</span>[u8] = <span class="string">b"abcdef123456"</span>;
<span class="kw">let </span><span class="kw-2">mut </span>f = tempfile().unwrap();
<span class="kw">let </span><span class="kw-2">mut </span>aiocb = Box::pin(AioWrite::new(f.as_raw_fd(),
    <span class="number">2</span>,   <span class="comment">//offset
    </span>WBUF,
    <span class="number">0</span>,   <span class="comment">//priority
    </span>SigevNotify::SigevNone));
aiocb.as_mut().submit().unwrap();
<span class="kw">while </span>(aiocb.as_mut().error() == <span class="prelude-val">Err</span>(Errno::EINPROGRESS)) {
    thread::sleep(time::Duration::from_millis(<span class="number">10</span>));
}
<span class="macro">assert_eq!</span>(aiocb.as_mut().aio_return().unwrap(), WBUF.len());</code></pre></div>
<h5 id="references-2"><a class="doc-anchor" href="#references-2">§</a>References</h5>
<p><a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/aio_error.html">aio_error</a></p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.fd" class="method"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#312">source</a><h4 class="code-header">fn <a href="#tymethod.fd" class="fn">fd</a>(&amp;self) -&gt; <a class="type" href="https://doc.rust-lang.org/1.81.0/std/os/fd/raw/type.RawFd.html" title="type std::os::fd::raw::RawFd">RawFd</a></h4></section></summary><div class="docblock"><p>Returns the underlying file descriptor associated with the operation.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.in_progress" class="method"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#341">source</a><h4 class="code-header">fn <a href="#tymethod.in_progress" class="fn">in_progress</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Does this operation currently have any in-kernel state?</p>
<p>Dropping an operation that does have in-kernel state constitutes a
resource leak.</p>
<h5 id="examples-2"><a class="doc-anchor" href="#examples-2">§</a>Examples</h5>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>f = tempfile().unwrap();
<span class="kw">let </span><span class="kw-2">mut </span>aiof = Box::pin(AioFsync::new(f.as_raw_fd(), AioFsyncMode::O_SYNC,
    <span class="number">0</span>, SigevNone));
<span class="macro">assert!</span>(!aiof.as_mut().in_progress());
aiof.as_mut().submit().expect(<span class="string">"aio_fsync failed early"</span>);
<span class="macro">assert!</span>(aiof.as_mut().in_progress());
<span class="kw">while </span>(aiof.as_mut().error() == <span class="prelude-val">Err</span>(Errno::EINPROGRESS)) {
    thread::sleep(time::Duration::from_millis(<span class="number">10</span>));
}
aiof.as_mut().aio_return().expect(<span class="string">"aio_fsync failed late"</span>);
<span class="macro">assert!</span>(!aiof.as_mut().in_progress());</code></pre></div>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.priority" class="method"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#344">source</a><h4 class="code-header">fn <a href="#tymethod.priority" class="fn">priority</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.i32.html">i32</a></h4></section></summary><div class="docblock"><p>Returns the priority of the <code>AioCb</code></p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.set_sigev_notify" class="method"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#348">source</a><h4 class="code-header">fn <a href="#tymethod.set_sigev_notify" class="fn">set_sigev_notify</a>(&amp;mut self, sev: <a class="enum" href="../signal/enum.SigevNotify.html" title="enum nix::sys::signal::SigevNotify">SigevNotify</a>)</h4></section></summary><div class="docblock"><p>Update the notification settings for an existing AIO operation that has
not yet been submitted.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.sigevent" class="method"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#351">source</a><h4 class="code-header">fn <a href="#tymethod.sigevent" class="fn">sigevent</a>(&amp;self) -&gt; <a class="struct" href="../signal/struct.SigEvent.html" title="struct nix::sys::signal::SigEvent">SigEvent</a></h4></section></summary><div class="docblock"><p>Returns the <code>SigEvent</code> that will be used for notification.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.submit" class="method"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#357">source</a><h4 class="code-header">fn <a href="#tymethod.submit" class="fn">submit</a>(self: <a class="struct" href="https://doc.rust-lang.org/1.81.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.reference.html">&amp;mut Self</a>&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Actually start the I/O operation.</p>
<p>After calling this method and until <a href="trait.Aio.html#tymethod.aio_return" title="method nix::sys::aio::Aio::aio_return"><code>Aio::aio_return</code></a> returns <code>Ok</code>,
the structure may not be moved in memory.</p>
</div></details></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><details class="toggle implementors-toggle"><summary><section id="impl-Aio-for-AioFsync" class="impl"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#475-492">source</a><a href="#impl-Aio-for-AioFsync" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Aio.html" title="trait nix::sys::aio::Aio">Aio</a> for <a class="struct" href="struct.AioFsync.html" title="struct nix::sys::aio::AioFsync">AioFsync</a></h3></section></summary><div class="impl-items"><section id="associatedtype.Output-1" class="associatedtype trait-impl"><a href="#associatedtype.Output-1" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.Output" class="associatedtype">Output</a> = <a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.unit.html">()</a></h4></section></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Aio-for-AioRead%3C'a%3E" class="impl"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#600-604">source</a><a href="#impl-Aio-for-AioRead%3C'a%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a&gt; <a class="trait" href="trait.Aio.html" title="trait nix::sys::aio::Aio">Aio</a> for <a class="struct" href="struct.AioRead.html" title="struct nix::sys::aio::AioRead">AioRead</a>&lt;'a&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.Output-2" class="associatedtype trait-impl"><a href="#associatedtype.Output-2" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.Output" class="associatedtype">Output</a> = <a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.usize.html">usize</a></h4></section></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Aio-for-AioWrite%3C'a%3E" class="impl"><a class="src rightside" href="../../../src/nix/sys/aio.rs.html#836-840">source</a><a href="#impl-Aio-for-AioWrite%3C'a%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'a&gt; <a class="trait" href="trait.Aio.html" title="trait nix::sys::aio::Aio">Aio</a> for <a class="struct" href="struct.AioWrite.html" title="struct nix::sys::aio::AioWrite">AioWrite</a>&lt;'a&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.Output-3" class="associatedtype trait-impl"><a href="#associatedtype.Output-3" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.Output" class="associatedtype">Output</a> = <a class="primitive" href="https://doc.rust-lang.org/1.81.0/std/primitive.usize.html">usize</a></h4></section></div></details></div><script src="../../../trait.impl/nix/sys/aio/trait.Aio.js" async></script></section></div></main></body></html>